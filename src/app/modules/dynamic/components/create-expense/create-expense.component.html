<div class="page-wrapper">
    <div class="page-content-tab">
        <div class="container-fluid">
            <div class="pt-2 pb-3">

                <button class="btn btn-primary" (click)="getExpenseType()" data-bs-toggle="modal"
                    data-bs-target="#createExpense">Create Expense</button>

                <div class="row mt-3">
                    <div class="table-responsive bg-white">
                        <table class="table empOnnoardtable">
                            <thead class="thead-light">
                                <tr>
                                    <th class="text-center" style="width: 10%">
                                        Date
                                    </th>
                                    <th class="text-center" style="width: 10%">
                                        Employee Name
                                    </th>
                                    <th class="text-center" style="width: 10%">
                                        Amount
                                    </th>

                                    <th class="text-center" style="width: 15%">
                                        Expense Type
                                    </th>

                                    <th class="text-center" style="width: 30%">
                                        Notes
                                    </th>

                                    <th class="text-center" style="width: 15%">
                                        Status
                                    </th>

                                    <th class="text-center" style="width: 10%">
                                        Action
                                    </th>

                                </tr>
                            </thead>

                            <tbody *ngIf="loading">
                                <tr *ngFor="let i of [1, 2, 3, 4, 5, 6]">
                                    <td *ngFor="let i of [1, 2, 3, 4, 5, 6,7]" class="text-center">
                                        <p class="shimmer"></p>
                                    </td>
                                </tr>
                            </tbody>

                            <tbody *ngIf="!loading">
                                <ng-container *ngIf="expenseList.length == 0">
                                    <tr>
                                        <td colspan="9">
                                            <div class="d-flex justify-content-center align-items-center"
                                                style="height: 50vh;">
                                                <div>
                                                    <img src="assets/images/no-data-found-img.svg" alt="" height="50%"
                                                        width="50%">
                                                    <h6 class="p-2" style="margin-left: -40px;">No Expenses Created
                                                        Yet!!</h6>
                                                </div>
                                            </div>
                                            <!-- <div class="d-flex justify-content-center"
                                    style="margin-top: -1%; margin-left: 4%; margin-bottom: 5px;">
                                    <h6>No Expenses Created Yet!!</h6>
                                  </div> -->
                                        </td>
                                    </tr>
                                </ng-container>

                                <ng-container *ngIf="expenseList.length > 0">
                                    <tr *ngFor="let expense of expenseList; let i= index">
                                        <td class="text-center">{{expense.expenseDate}}</td>
                                        <td class="text-center">{{expense.employeeName}}</td>
                                        <td class="text-center">{{expense.amount}}</td>
                                        <td class="text-center">{{expense.expenseType}}</td>
                                        <td class="text-center">{{expense.notes}}</td>
                                        <td class="text-center">Pending</td>
                                        <td class="text-center">
                                            <div>
                                                <button type="button" class="btn" (click)="updateExpense(expense)"
                                                    data-bs-toggle="modal" data-bs-target="#createExpense">
                                                    <i class="bi bi-pencil-square pointer text-primary"></i>
                                                </button>

                                                <button type="button" class="btn" (click)="getExpenseId(expense.id)"
                                                    data-bs-toggle="modal" data-bs-target="#delete-expense">
                                                    <i class="bi bi-trash pointer text-danger"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                </ng-container>

                            </tbody>

                        </table>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>



<!-- Create expense modal start -->
<div class="modal fade" id="createExpense" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Apply for expense</h5>
                <button type="button" class="close-btn" data-bs-dismiss="modal" (click)="clearExpenseForm(createForm)"
                    aria-label="Close" #closeExpenseButton>
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <mask id="mask0_5037_2014" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0"
                            width="24" height="24">
                            <rect width="24" height="24" fill="#D9D9D9" />
                        </mask>
                        <g mask="url(#mask0_5037_2014)">
                            <path
                                d="M6.4 19L5 17.6L10.6 12L5 6.4L6.4 5L12 10.6L17.6 5L19 6.4L13.4 12L19 17.6L17.6 19L12 13.4L6.4 19Z"
                                fill="black" />
                        </g>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="assets-request-form">
                    <!-- <form #createForm="ngForm" ngNativeValidate (ngSubmit)="createExpense()"> -->
                    <form #createForm="ngForm" (ngSubmit)="checkExpensePolicy(createForm)">
                        <!-- <form #createForm="ngForm" ngNativeValidate (ngSubmit)="validatePolicyToggle ? checkExpensePolicy() : createExpense()"> -->
                        <div class="row register-form-box">
                            <div class="col-md-12 mb-3">
                                <div class="form-group">
                                    <label for="expenseType" class="mb-2">Expense type</label>

                                    <nz-select style="width: 100%" nzSize="large" nzPlaceHolder="Select Expense type"
                                        [(ngModel)]="expenseTypeId" (ngModelChange)="getExpenseTypeId($event)" required
                                        name="expTypeId" #expTypeId="ngModel" class="form-control">
                                        <nz-option *ngFor=" let expenseType of expenseTypeList"
                                            [nzValue]="expenseType.id" [nzLabel]="expenseType.name">
                                        </nz-option>
                                    </nz-select>


                                    <div *ngIf="expTypeId?.invalid && expTypeId?.touched" class="error-message">
                                        Expense type is required.
                                    </div>

                                </div>
                            </div>

                            <div class="col-md-12 mb-3" nz-form-item>
                                <label for="expenseDate" class="pb-2 font-12">Expense Date
                                </label>
                                <div class="d-flex justify-content-between align-items-center">
                                    <nz-date-picker [(ngModel)]="expenseTypeReq.expenseDate"
                                        nzPlaceHolder="Select Expense Date" [nzDisabledDate]="disableFutureDates"
                                        (ngModelChange)="selectExpenseDate($event)" name="expDate" #expDate="ngModel"
                                        required class="form-control">
                                    </nz-date-picker>
                                </div>
                                <div *ngIf="expDate?.touched && expDate?.invalid" style="color: red;">Expense Date is
                                    required</div>
                            </div>

                            <div class="col-md-12 mb-3">
                                <div class="form-group">
                                    <label for="expenseAmount" class="mb-2"> Amount</label>
                                    <input type="number" required min="1" id="amount" name="amount"
                                        placeholder="Enter Amount" class="form-control"
                                        [(ngModel)]="expenseTypeReq.amount" #amountInput="ngModel" />

                                    <!-- Required validation message -->
                                    <div *ngIf="amountInput.errors?.required && (amountInput.dirty || amountInput.touched)"
                                        style="color: red;">
                                        Amount is required.
                                    </div>

                                    <!-- Min value validation message for negative values or zero -->
                                    <div *ngIf="amountInput.errors?.min && (amountInput.dirty || amountInput.touched)"
                                        style="color: red;">
                                        Amount must be a positive number greater than 0.
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-12 mb-3">
                                <div class="form-group">
                                    <label for="templateName" class="mb-2"> Note</label>
                                    <textarea class="form-control nots-section" required placeholder="write the note"
                                        id="notes" rows="3" name="notes" [(ngModel)]="expenseTypeReq.notes"
                                        #notesInput="ngModel"></textarea>
                                </div>

                                <div *ngIf="notesInput.errors?.required && notesInput.touched" style="color: red;">
                                    Notes is required.
                                </div>
                            </div>

                            <div class="col-md-12 ">
                                <div class="form-group ">
                                    <label for="templateName" class="mb-2"> Proof document <span
                                            class="text-primary font-12">(optional)</span></label>
                                    <div
                                        class="d-flex align-items-center justify-content-between  requesting-half-leave p-2">
                                        <p class="mb-0 font-13 " style="font-weight: 400;">Select proof document</p>

                                        <button *ngIf="!isUploading && expenseTypeReq.url == ''" type="button"
                                            (click)="fileInput.click()" class="btn p-0 text-primary font-13">
                                            <i class="bi bi-plus-lg"></i> Add File
                                        </button>

                                        <div *ngIf="isUploading"
                                            class="spinner-border spinner-border-sm text-primary m-2" role="status">
                                            <span class="visually-hidden">Loading...</span>
                                        </div>

                                        <input type="file" #fileInput (change)="onFileSelected($event)"
                                            accept=".png, .jpg, .jpeg" style="display: none;" />

                                    </div>


                                    <div *ngIf="expenseTypeReq.url != ''"
                                        class="hr-policy-file d-flex justify-content-between align-items-center p-3 mt-3">
                                        <div class="d-flex align-items-center gap-2">
                                            <div class="d-flex align-items-center gap-2">
                                                <img src="{{expenseTypeReq.url}}" alt="" width="31" height="37">
                                                <h5 class="mb-0 font-14 mx-2 mt-2">{{fileName}}</h5>
                                            </div>
                                        </div>
                                        <div class="d-flex align-items-center gap-2 action-icon-btn">
                                            <span>
                                                <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22"
                                                    viewBox="0 0 22 22" fill="none">
                                                    <mask id="mask0_4339_1635" maskUnits="userSpaceOnUse" x="0" y="0"
                                                        width="22" height="22" style="mask-type: alpha;">
                                                        <rect width="21.8342" height="21.8342" fill="#D9D9D9"></rect>
                                                    </mask>
                                                    <g mask="url(#mask0_4339_1635)">
                                                        <path
                                                            d="M10.9189 14.1711C11.9498 14.1711 12.8254 13.8103 13.5456 13.0888C14.2658 12.3672 14.6259 11.4909 14.6259 10.46C14.6259 9.4291 14.2651 8.55354 13.5435 7.83331C12.822 7.11308 11.9457 6.75297 10.9148 6.75297C9.88389 6.75297 9.00833 7.11377 8.2881 7.83536C7.56788 8.55695 7.20776 9.4332 7.20776 10.4641C7.20776 11.495 7.56856 12.3706 8.29015 13.0908C9.01174 13.811 9.88799 14.1711 10.9189 14.1711ZM10.9168 12.9184C10.2345 12.9184 9.65456 12.6796 9.17694 12.202C8.69931 11.7243 8.4605 11.1444 8.4605 10.4621C8.4605 9.77974 8.69931 9.19977 9.17694 8.72214C9.65456 8.24452 10.2345 8.00571 10.9168 8.00571C11.5992 8.00571 12.1791 8.24452 12.6568 8.72214C13.1344 9.19977 13.3732 9.77974 13.3732 10.4621C13.3732 11.1444 13.1344 11.7243 12.6568 12.202C12.1791 12.6796 11.5992 12.9184 10.9168 12.9184ZM10.918 16.8304C8.826 16.8304 6.91983 16.2533 5.19947 15.0991C3.47912 13.9451 2.21243 12.3994 1.39941 10.4621C2.21243 8.52473 3.47867 6.97905 5.19811 5.82502C6.9177 4.67084 8.82357 4.09375 10.9157 4.09375C13.0077 4.09375 14.9139 4.67084 16.6342 5.82502C18.3546 6.97905 19.6213 8.52473 20.4343 10.4621C19.6213 12.3994 18.355 13.9451 16.6356 15.0991C14.916 16.2533 13.0101 16.8304 10.918 16.8304ZM10.9168 15.4657C12.6302 15.4657 14.2033 15.0146 15.6362 14.1125C17.0691 13.2103 18.1646 11.9935 18.9227 10.4621C18.1646 8.93063 17.0691 7.71383 15.6362 6.81165C14.2033 5.90948 12.6302 5.45839 10.9168 5.45839C9.20347 5.45839 7.63035 5.90948 6.19748 6.81165C4.76461 7.71383 3.66911 8.93063 2.91098 10.4621C3.66911 11.9935 4.76461 13.2103 6.19748 14.1125C7.63035 15.0146 9.20347 15.4657 10.9168 15.4657Z"
                                                            fill="#1C1B1F"></path>
                                                    </g>
                                                </svg>

                                            </span>
                                            <input id="hrpolicies" type="file" name="hrpolicies"
                                                accept="application/pdf" class="input" style="display: none;">

                                            <span>
                                                <svg (click)="deleteImage()" xmlns="http://www.w3.org/2000/svg"
                                                    width="23" height="22" viewBox="0 0 23 22" fill="none">
                                                    <mask id="mask0_4339_1620" maskUnits="userSpaceOnUse" x="0" y="0"
                                                        width="23" height="22" style="mask-type: alpha;">
                                                        <rect x="0.535156" width="21.8342" height="21.8342"
                                                            fill="#D9D9D9"></rect>
                                                    </mask>
                                                    <g mask="url(#mask0_4339_1620)">
                                                        <path
                                                            d="M7.18328 18.6577C6.72961 18.6577 6.34206 18.497 6.02061 18.1757C5.69931 17.8543 5.53866 17.4667 5.53866 17.0131V5.46619H4.62891V4.10156H8.72282V3.29688H14.1814V4.10156H18.2753V5.46619H17.3655V17.0131C17.3655 17.4726 17.2063 17.8616 16.8879 18.1801C16.5695 18.4985 16.1805 18.6577 15.7209 18.6577H7.18328ZM16.0009 5.46619H6.9033V17.0131C6.9033 17.0948 6.92953 17.1619 6.982 17.2144C7.03446 17.2668 7.10155 17.293 7.18328 17.293H15.7209C15.791 17.293 15.8551 17.2639 15.9133 17.2055C15.9717 17.1473 16.0009 17.0831 16.0009 17.0131V5.46619ZM9.09036 15.4735H10.4548V7.28571H9.09036V15.4735ZM12.4494 15.4735H13.8138V7.28571H12.4494V15.4735Z"
                                                            fill="#FF0000"></path>
                                                    </g>
                                                </svg>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div> <!-- proof end -->

                            <div *ngIf="validatePolicyToggle" class="alert bg-soft-warning border">
                                This Expense is valid for amount: {{limitAmount}}
                                <div>
                                    <span>Do you continue</span>
                                    <button (click)="createExpense(createForm)">Continue</button>
                                    <button (click)="setValidateToggle()">No</button>
                                </div>
                            </div>

                        </div>

                        <div *ngIf="!validatePolicyToggle" class="modal-footer">
                            <button type="button" class="btn cancel-btn" data-bs-dismiss="modal"
                                (click)="clearExpenseForm(createForm)">Cancel</button>

                            <button *ngIf="!createToggle" type="submit" class="btn submitActionBtn"
                                [disabled]="expenseTypeReq.expenseTypeId == 0 || expenseTypeReq.expenseDate == undefined || expenseTypeReq.notes == '' || expenseTypeReq.amount == undefined || expenseTypeReq.amount <= 0">
                                {{expenseTypeReq.id == 0 ? 'Submit' : 'Update'}}
                            </button>

                            <div class="dot-opacity-loader" *ngIf="createToggle">
                                <span></span>
                                <span></span>
                                <span></span>
                            </div>

                        </div>

                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Create expense modal end -->


<!-- delete Expense Modal -->
<div class="modal fade" id="delete-expense" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" style="max-width: 500px" role="document">
        <div class="modal-content">
            <div class="modal-body p-0 delete-text">
                <div class="delete-image d-flex align-items-center justify-content-center pt-4 pb-4">
                    <div class="delete-close-btn">
                        <button type="button" class="close-btn" data-bs-dismiss="modal" aria-label="Close"
                            #closeButtonDeleteExpense>
                            <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30"
                                fill="none">
                                <mask id="mask0_2031_1331" style="mask-type: alpha" maskUnits="userSpaceOnUse" x="0"
                                    y="0" width="30" height="30">
                                    <rect width="30" height="30" fill="#D9D9D9" />
                                </mask>
                                <g mask="url(#mask0_2031_1331)">
                                    <path
                                        d="M8 23.75L6.25 22L13.25 15L6.25 8L8 6.25L15 13.25L22 6.25L23.75 8L16.75 15L23.75 22L22 23.75L15 16.75L8 23.75Z"
                                        fill="black" />
                                </g>
                            </svg>
                        </button>
                    </div>
                    <img src="/assets/images/delete-img.svg" style="width: 70px" />
                </div>
                <div class="bg-white p-4 text-center">

                    <div>
                        <h5 class="alert-heading font-18 mb-2">
                            Are you sure you want to delete <br />
                        </h5>
                        <p class="font-11">You will not be able to recover this</p>
                    </div>

                    <div class="mt-4 d-flex align-items-center flex-column">
                        <button [disabled]="deleteToggle" class="btn continue-btn" (click)="deleteExpense()">
                            Continue
                            <i class="fa fa-spinner fa-spin" *ngIf="deleteToggle"></i>
                        </button>

                        <button class="btn cancel-btn pt-2" type="button" data-bs-dismiss="modal" aria-label="Close">
                            Cancel
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- delete Expense Modal End -->